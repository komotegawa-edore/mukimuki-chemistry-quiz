# CSV問題インポートガイド

## 📋 CSV形式の仕様

### ヘッダー行（必須）

```csv
chapter_id,question_text,choice_a,choice_b,choice_c,choice_d,correct_answer
```

### 各列の説明

| 列名 | 説明 | 必須 | 形式 | 例 |
|------|------|------|------|-----|
| `chapter_id` | 章のID | ✅ | 数値（1-33） | 1 |
| `question_text` | 問題文 | ✅ | テキスト | 水素の製法として正しいのはどれか？ |
| `choice_a` | 選択肢A | ✅ | テキスト | 水の電気分解 |
| `choice_b` | 選択肢B | ✅ | テキスト | 塩酸と硫酸の反応 |
| `choice_c` | 選択肢C | ✅ | テキスト | 酸化鉄の還元 |
| `choice_d` | 選択肢D | ✅ | テキスト | 水素化ナトリウムの分解 |
| `correct_answer` | 正解 | ✅ | A/B/C/D | A |

---

## ✅ 作成ルール

### 1. ファイル形式
- エンコーディング: **UTF-8**
- 拡張子: `.csv`
- 改行コード: LF または CRLF

### 2. データ形式
- ヘッダー行は**必須**
- 1行目: ヘッダー
- 2行目以降: 問題データ
- カンマ区切り（`,`）

### 3. 章ID（chapter_id）
- 1〜33の整数
- 存在する章IDのみ使用可能

### 4. 正解（correct_answer）
- **A**, **B**, **C**, **D** のいずれか（大文字）
- それ以外は無効

### 5. テキストフィールド
- カンマを含む場合はダブルクォートで囲む
- 例: `"これは、カンマを含む文章です"`
- ダブルクォート自体を含む場合は2つ連続で記述
- 例: `"彼は""はい""と答えた"`

---

## 📄 サンプルCSV

### 基本例

```csv
chapter_id,question_text,choice_a,choice_b,choice_c,choice_d,correct_answer
1,水素の製法として正しいのはどれか？,水の電気分解,塩酸と硫酸の反応,酸化鉄の還元,水素化ナトリウムの分解,A
1,水素の性質について誤っているものはどれか？,無色無臭の気体,最も軽い元素,水に溶けやすい,還元性を持つ,C
```

### カンマを含む例

```csv
chapter_id,question_text,choice_a,choice_b,choice_c,choice_d,correct_answer
1,"水素は、最も軽い元素である。正しいか？",正しい,誤り,どちらでもない,不明,A
```

---

## 🚀 インポート手順

### 1. CSVファイルの準備

1. Excel、Google Sheets、テキストエディタでCSVを作成
2. 上記の形式に従ってデータを入力
3. UTF-8で保存

**Excelの場合:**
- 「名前を付けて保存」→「CSV UTF-8（カンマ区切り）」を選択

**Google Sheetsの場合:**
- 「ファイル」→「ダウンロード」→「カンマ区切り形式（.csv）」

### 2. アプリでインポート

1. 講師アカウントでログイン
2. ダッシュボードに移動
3. 「CSV一括インポート」ボタンをクリック
4. CSVファイルを選択
5. プレビューで内容を確認
6. 「インポート」ボタンをクリック

### 3. 結果確認

- インポート成功: 成功した問題数が表示される
- インポート失敗: エラーメッセージと該当行が表示される

---

## ⚠️ よくあるエラーと対処法

### エラー1: 「ヘッダー行が正しくありません」

**原因:** 1行目のヘッダーが仕様と一致していない

**対処法:**
```csv
chapter_id,question_text,choice_a,choice_b,choice_c,choice_d,correct_answer
```
この通りに記述（コピペ推奨）

---

### エラー2: 「章ID 99 は存在しません」

**原因:** 存在しない章IDを指定している

**対処法:** chapter_id は 1〜33 の範囲で指定

---

### エラー3: 「正解は A, B, C, D のいずれかである必要があります」

**原因:** correct_answer が小文字や数字になっている

**対処法:** 必ず大文字の A, B, C, D を使用

---

### エラー4: 「必須項目が不足しています」

**原因:** 空白のセルがある

**対処法:** すべてのセルに値を入力

---

### エラー5: 文字化け

**原因:** エンコーディングがUTF-8でない

**対処法:**
- Excelの場合: 「CSV UTF-8（カンマ区切り）」で保存
- テキストエディタの場合: UTF-8で保存

---

## 📊 インポート制限

- **1回のインポート上限:** 500問
- **ファイルサイズ上限:** 5MB
- **同時インポート:** 1ユーザーにつき1回のみ

---

## 💡 Tips

### 効率的な問題作成方法

1. **Google Sheetsを使用**
   - 共同編集可能
   - 自動保存
   - 簡単にCSVエクスポート

2. **テンプレートを活用**
   - `public/sample_questions.csv` をダウンロード
   - コピーして編集

3. **章ごとに分けて作成**
   - 1ファイルに1章分の問題
   - 管理しやすい
   - エラーがあっても影響範囲が小さい

4. **バリデーションを活用**
   - Excelのデータ検証機能を使用
   - correct_answer はドロップダウンで A/B/C/D のみ選択可能に

---

## 📁 サンプルファイル

`/public/sample_questions.csv` にサンプルファイルがあります。
ダウンロードして参考にしてください。

---

## 🆘 サポート

問題がある場合は、以下を確認してください：
1. CSV形式が正しいか
2. エンコーディングがUTF-8か
3. ヘッダー行が正しいか
4. すべての必須項目が入力されているか
5. 正解が A/B/C/D（大文字）か

それでも解決しない場合は、サンプルCSVと同じ形式で作成してみてください。
