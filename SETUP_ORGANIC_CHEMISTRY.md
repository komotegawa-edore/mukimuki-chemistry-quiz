# 有機化学セクション追加ガイド

このガイドでは、有機化学の章とサンプル問題を追加する手順を説明します。

---

## 📋 前提条件

以下のマイグレーションが**完了していること**を確認してください：

1. ✅ `supabase/migration_multi_subject.sql` - マルチ教科対応
2. ✅ `supabase/storage_setup.sql` - Storageバケット作成

---

## 🚀 実行手順

### Step 1: Supabase Dashboardにアクセス

1. [Supabase Dashboard](https://supabase.com/dashboard)にログイン
2. プロジェクト「mukimuki」を選択
3. 左メニューから **SQL Editor** をクリック

---

### Step 2: マイグレーションSQLを実行（未実行の場合）

#### 2-1. マルチ教科対応マイグレーション

**ファイル:** `supabase/migration_multi_subject.sql`

1. SQL Editorで **New Query** をクリック
2. ファイルの内容をコピー＆ペースト
3. **Run** ボタンをクリック

**期待される結果:**
```
Success. No rows returned
```

#### 2-2. Storageバケット作成

**ファイル:** `supabase/storage_setup.sql`

1. SQL Editorで **New Query** をクリック
2. ファイルの内容をコピー＆ペースト
3. **Run** ボタンをクリック

**期待される結果:**
```
Success. No rows returned
```

---

### Step 3: 有機化学の章とサンプル問題を追加

**ファイル:** `supabase/add_organic_chemistry_chapters.sql`

1. SQL Editorで **New Query** をクリック
2. 以下の内容をコピー＆ペースト
3. **Run** ボタンをクリック

**追加される内容:**
- 有機化学の12章
  - 第1章 アルカン
  - 第2章 アルケン・アルキン
  - 第3章 芳香族化合物
  - 第4章 アルコール・エーテル
  - 第5章 アルデヒド・ケトン
  - 第6章 カルボン酸・エステル
  - 第7章 芳香族化合物の反応
  - 第8章 異性体
  - 第9章 油脂・セッケン
  - 第10章 糖類
  - 第11章 アミノ酸・タンパク質
  - 第12章 合成高分子化合物

- サンプル問題（6問）
  - 第1章に3問
  - 第3章に3問

**期待される結果:**
最後に確認クエリが実行され、以下のような表が表示されます：

| id | order_num | title | question_count |
|----|-----------|-------|----------------|
| XX | 1 | 第1章 アルカン | 3 |
| XX | 2 | 第2章 アルケン・アルキン | 0 |
| XX | 3 | 第3章 芳香族化合物 | 3 |
| ... | ... | ... | ... |

---

## ✅ 動作確認

### 1. 教科一覧を確認

アプリにアクセス：
```
https://あなたのアプリURL/subjects
```

**確認項目:**
- ✅ 「無機化学」「有機化学」「リスニング」が表示される
- ✅ 有機化学のカードに「画像問題対応」バッジが表示される

---

### 2. 有機化学の章一覧を確認

「有機化学」をクリック

**確認項目:**
- ✅ 12章すべてが表示される
- ✅ 章番号が正しい順序で並んでいる

---

### 3. サンプル問題を解いてみる

「第1章 アルカン」をクリック → クイズ開始

**確認項目:**
- ✅ 3問の問題が表示される
- ✅ 正解・不正解が判定される
- ✅ 解説が表示される

---

## 🖼️ 画像付き問題の追加方法（講師）

### 1. 講師アカウントでログイン

### 2. ダッシュボードにアクセス

```
https://あなたのアプリURL/dashboard
```

### 3. 問題管理画面へ

1. 「問題管理」をクリック
2. 「有機化学」を選択
3. 章を選択（例：第3章 芳香族化合物）

### 4. 新しい問題を追加

1. 「+ 新しい問題を追加」ボタンをクリック
2. **問題タイプ**: 「画像あり（有機化学など）」を選択
3. 問題文を入力
4. **問題文の画像**: 構造式の画像をアップロード
   - ChemDrawなどで作成した構造式
   - PNG/JPG形式、最大10MB
5. 選択肢A〜Dを入力
6. 必要に応じて選択肢に画像を追加
7. 正解を選択
8. 解説を入力
9. 「保存」をクリック

---

## 🎯 次のステップ

### 1. 他の章にも問題を追加

講師ダッシュボードから、各章に問題を追加していきます。

### 2. リスニング問題の追加

同様の手順で、リスニング教科にも章と問題を追加できます。
この場合、問題タイプで「音声あり（リスニング）」を選択します。

---

## 🛠️ トラブルシューティング

### エラー: duplicate key value violates unique constraint

**原因:** すでに同じデータが存在している

**解決策:**
```sql
-- 既存データを確認
SELECT * FROM mukimuki_chapters WHERE subject_id = 2;

-- 必要に応じて削除してから再実行
DELETE FROM mukimuki_chapters WHERE subject_id = 2;
```

### 教科一覧に有機化学が表示されない

**原因:** マイグレーションが未実行

**解決策:**
1. `supabase/migration_multi_subject.sql` を実行
2. 以下のクエリで確認:
```sql
SELECT * FROM mukimuki_subjects ORDER BY display_order;
```

---

**作成日:** 2025-11-22
**対象:** 有機化学セクション追加
